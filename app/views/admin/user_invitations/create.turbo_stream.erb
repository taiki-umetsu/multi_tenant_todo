<% if @invitation.persisted? %>
  <% invitation_url = new_user_url(token: @invitation.token) %>
  <%= turbo_stream.update "invitation_result" do %>
    <div class="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
      <h4 class="px-2 py-2 text-sm font-medium text-green-800 mb-2">招待URLが生成されました</h4>
      <div class="bg-white border rounded px-4 py-2 text-sm font-mono break-all mb-3 max-w-full overflow-x-auto">
        <div class="whitespace-nowrap overflow-x-scroll scrollbar-thin">
          <%= invitation_url %>
        </div>
      </div>
      <div data-controller="clipboard" data-clipboard-text-value="<%= invitation_url %>">
        <%= render ButtonComponent.new(
          text: "URLをコピー",
          type: :secondary,
          data: {
            clipboard_target: "button",
            action: "click->clipboard#copy"
          }
        ) %>
      </div>
    </div>
  <% end %>

  <%= turbo_stream.prepend "invitation_tbody" do %>
    <%= render TableRowComponent.new do |row| %>
      <% @invitation.to_table_row.each do |cell_data| %>
        <% row.with_cell(**cell_data) %>
      <% end %>
    <% end %>
  <% end %>

  <%= turbo_stream.update "invitation_count" do %>
    <%= @invitation_count %>件
  <% end %>
<% else %>
  <%= turbo_stream.update "invitation_result" do %>
    <div class="mt-4 bg-red-50 border border-red-200 rounded-lg p-4">
      <ul class="text-sm text-red-700">
        <% @invitation.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
<% end %>
